# Autogenerated bulkloader.yaml file.
# You must edit this file before using it. TODO: Remove this line when done.
# At a minimum address the items marked with TODO:
#  * Fill in connector and connector_options
#  * Review the property_map.
#    - Ensure the 'external_name' matches the name of your CSV column,
#      XML tag, etc.
#    - Check that __key__ property is what you want. Its value will become
#      the key name on import, and on export the value will be the Key
#      object.  If you would like automatic key generation on import and
#      omitting the key on export, you can remove the entire __key__
#      property from the property map.

# If you have module(s) with your model classes, add them here. Also
# change the kind properties to model_class.
python_preamble:
- import: base64
- import: re
- import: google.appengine.ext.bulkload.transform
- import: google.appengine.ext.bulkload.bulkloader_wizard
- import: google.appengine.ext.db
- import: google.appengine.api.datastore
- import: google.appengine.api.users

- import: helpers

transformers:

- kind: ImageFile
  connector: csv
  connector_options:
    encoding: utf-8
    columns: from_header
  #post_import_function: helpers.post_get_blob_key
    # TODO: Add connector options here--these are specific to each connector.
  property_map:
    - property: __key__
      external_name: key
      export_transform: transform.key_id_or_name_as_string

    - property: created_at
      external_name: created_at
      # Type: Date/Time Stats: 34 properties of this type in this kind.
      import_transform: transform.import_date_time('%Y-%m-%dT%H:%M:%S')
      export_transform: transform.export_date_time('%Y-%m-%dT%H:%M:%S')

    - property: file
      external_name: file
      # Type: BlobKey Stats: 34 properties of this type in this kind.
      #import_transform: helpers.get_blob_key('tete')
      import_transform: "lambda x: x is not None and len(x) > 0 and eval(x) or ['']"
      
    - property: filename
      external_name: filename
      # Type: String Stats: 34 properties of this type in this kind.

    - property: property
      external_name: property
      #import_transform: transform.create_foreign_key('Property', key_is_id=False)
      import_transform: helpers.create_foreign_key('Property')
      
    - property: title
      external_name: title
      # Type: String Stats: 34 properties of this type in this kind.


- kind: Property
  connector: csv
  connector_options:
    encoding: utf-8
    columns: from_header
  property_map:

    - property: __key__
      external_name: key
      export_transform: transform.key_id_or_name_as_string
    
    - property: country
      external_name: country
      
    - property: state
      external_name: state
    
    - property: city
      external_name: city 
    
    - property: neighborhood
      external_name: neighborhood
    
    - property: street_name
      external_name: street_name
    
    - property: street_number
      external_name: street_number
      import_transform: transform.none_if_empty(int)
      
    - property: zip_code                
      external_name: zip_code
  
    - property: rooms              
      external_name: rooms
      import_transform: transform.none_if_empty(int)
      
    - property: bathrooms               
      external_name: bathrooms
      import_transform: transform.none_if_empty(int)
      
    - property: bedrooms                
      external_name: bedrooms
      import_transform: transform.none_if_empty(int)
      
    - property: year_built              
      external_name: year_built
      import_transform: transform.none_if_empty(int)
      
    - property: prop_type_id         
      external_name: prop_type_id
      #import_transform: transform.none_if_empty(int)
      
    - property: prop_state_id             
      external_name: prop_state_id
      import_transform: transform.none_if_empty(int)
      
    - property: prop_operation_state_id            
      external_name: prop_operation_state_id
      import_transform: transform.none_if_empty(int)
      
    - property: prop_owner_id        
      external_name: prop_owner_id
      import_transform: transform.none_if_empty(int)
      
    - property: prop_operation_id        
      external_name: prop_operation_id
      import_transform: transform.none_if_empty(int)
      
    - property: images_count            
      external_name: images_count
      import_transform: transform.none_if_empty(int)

    - property: building_floors
      external_name: building_floors
      import_transform: transform.none_if_empty(int)
      
    - property: floor                   
      external_name: floor
      
    - property: balcony                 
      external_name: balcony
      import_transform: transform.none_if_empty(int)
      
    - property: garden                  
      external_name: garden
      import_transform: transform.none_if_empty(int)
    
    - property: sum
      external_name: sum
      import_transform: transform.none_if_empty(int)
      
    - property: terrace                 
      external_name: terrace
      import_transform: transform.none_if_empty(int)
      
    - property: grillroom               
      external_name: grillroom
      import_transform: transform.none_if_empty(int)
      
    - property: appurtenance            
      external_name: appurtenance
      import_transform: transform.none_if_empty(int)
      
    - property: garage                  
      external_name: garage
      import_transform: transform.none_if_empty(int)
      
    - property: furnished               
      external_name: furnished
      import_transform: transform.none_if_empty(int)
      
    - property: elevator                
      external_name: elevator
      import_transform: transform.none_if_empty(int)
      
    - property: fireplace               
      external_name: fireplace
      import_transform: transform.none_if_empty(int)
      
    - property: gym                     
      external_name: gym
      import_transform: transform.none_if_empty(int)
      
    - property: pool                    
      external_name: pool
      import_transform: transform.none_if_empty(int)
      
    - property: doorman                 
      external_name: doorman
      import_transform: transform.none_if_empty(int)
      
    - property: luxury                  
      external_name: luxury
      import_transform: transform.none_if_empty(int)
      
    - property: live_work               
      external_name: live_work
      import_transform: transform.none_if_empty(int)
      
    - property: washer_dryer            
      external_name: washer_dryer
      import_transform: transform.none_if_empty(int)
    
    - property: agua_corriente
      external_name: agua_corriente
      import_transform: transform.none_if_empty(int)
    
    - property: gas_natural
      external_name: gas_natural
      import_transform: transform.none_if_empty(int)
      
    - property: gas_envasado
      external_name: gas_envasado
      import_transform: transform.none_if_empty(int)
      
    - property: luz
      external_name: luz
      import_transform: transform.none_if_empty(int)
      
    - property: cloacas
      external_name: cloacas
      import_transform: transform.none_if_empty(int)
      
    - property: telefono
      external_name: telefono
      import_transform: transform.none_if_empty(int)
      
    - property: tv_cable
      external_name: tv_cable
      import_transform: transform.none_if_empty(int)
      
    - property: internet
      external_name: internet
      import_transform: transform.none_if_empty(int)
      
    - property: vigilancia
      external_name: vigilancia
      import_transform: transform.none_if_empty(int)
      
    - property: monitoreo 
      external_name: monitoreo 
      import_transform: transform.none_if_empty(int)
      
    - property: headline
      external_name: headline
      # Type: String Stats: 10 properties of this type in this kind.

    - property: main_description
      external_name: main_description
    
    - property: area_indoor
      external_name: area_indoor
      import_transform: transform.none_if_empty(int)
      #import_transform: helpers.get_float('hehe') #transform.none_if_empty(float)
    
    - property: area_outdoor
      external_name: area_outdoor
      import_transform: transform.none_if_empty(int)
      #import_transform: transform.none_if_empty(float)
    
    - property: realestate
      external_name: realestate
      export_transform: transform.key_id_or_name_as_string
      import_transform: helpers.create_foreign_key('RealEstate')
    
    - property: price_sell
      external_name: price_sell
      import_transform: transform.none_if_empty(float)
      
    - property: price_rent
      external_name: price_rent
      import_transform: transform.none_if_empty(float)
    
    - property: price_sell_currency
      external_name: price_sell_currency
    
    - property: price_rent_currency
      external_name: price_rent_currency
          
    - property: price_sell_computed
      external_name: price_sell_computed
      import_transform: transform.none_if_empty(float)
    
    - property: price_rent_computed
      external_name: price_rent_computed
      import_transform: transform.none_if_empty(float)
    
    - property: location
      external_name: location
      # Type: GeoPt Stats: 10 properties of this type in this kind.
      import_transform: helpers.get_geo('hehe') #transform.none_if_empty(float)
  
- kind: PropertyIndex
  connector: csv
  connector_options:
    encoding: utf-8
    columns: from_header
  property_map:
    - property: __key__
      external_name: key
      export_transform: transform.key_id_or_name_as_string
      
    - property: location
      external_name: location
      # Type: GeoPt Stats: 10 properties of this type in this kind.
      import_transform: helpers.get_geo('hehe') #transform.none_if_empty(float)
      
    - property: location_geocells
      external_name: location_geocells
      # Type: String Stats: 130 properties of this type in this kind.
      import_transform: "lambda x: x is not None and len(x) > 0 and eval(x) or ['']"
    
    - property: price_sell_computed
      external_name: price_sell_computed
      import_transform: transform.none_if_empty(float)
    
    - property: price_rent_computed
      external_name: price_rent_computed
      import_transform: transform.none_if_empty(float)
      
    - property: area_indoor
      external_name: area_indoor
      # Type: Float Stats: 10 properties of this type in this kind.
      import_transform: transform.none_if_empty(int)
      #import_transform: helpers.get_float('hehe') #transform.none_if_empty(float)
    
    - property: rooms              
      external_name: rooms
      import_transform: transform.none_if_empty(int)
      
    - property: bedrooms                
      external_name: bedrooms
      import_transform: transform.none_if_empty(int)

    - property: realestate
      external_name: realestate
      export_transform: transform.key_id_or_name_as_string
      import_transform: helpers.create_foreign_key('RealEstate')
      
    - property: property
      external_name: property
      export_transform: transform.key_id_or_name_as_string
      import_transform: helpers.create_foreign_key('Property')
    
    - property: price
      external_name: price
      import_transform: transform.none_if_empty(float)

    - property: published_at
      external_name: published_at
      import_transform: transform.import_date_time('%Y-%m-%dT%H:%M:%S')
      export_transform: transform.export_date_time('%Y-%m-%dT%H:%M:%S')
    
    - property: price_changed_at
      external_name: price_changed_at
      import_transform: transform.import_date_time('%Y-%m-%dT%H:%M:%S')
      export_transform: transform.export_date_time('%Y-%m-%dT%H:%M:%S')
    
    - property: images_count
      external_name: images_count
      import_transform: transform.none_if_empty(int)
      
- kind: RealEstate
  connector: csv
  connector_options:
    encoding: utf-8
    columns: from_header
# TODO: Add connector options here--these are specific to each connector.
  property_map:
    - property: __key__
      external_name: key
      export_transform: transform.key_id_or_name_as_string

    - property: created_at
      external_name: created_at
      # Type: Date/Time Stats: 10 properties of this type in this kind.
      import_transform: transform.import_date_time('%Y-%m-%dT%H:%M:%S')
      export_transform: transform.export_date_time('%Y-%m-%dT%H:%M:%S')

    - property: email
      external_name: email
      # Type: Email Stats: 10 properties of this type in this kind.
      import_transform: db.Email

    - property: fax_number
      external_name: fax_number
      # Type: PhoneNumber Stats: 10 properties of this type in this kind.
      import_transform: db.PhoneNumber

    - property: name
      external_name: name
      # Type: String Stats: 10 properties of this type in this kind.

    - property: telephone_number
      external_name: telephone_number
      # Type: PhoneNumber Stats: 10 properties of this type in this kind.
      import_transform: db.PhoneNumber

    - property: title
      external_name: title
      # Type: String Stats: 10 properties of this type in this kind.

    - property: updated_at
      external_name: updated_at
      # Type: Date/Time Stats: 10 properties of this type in this kind.
      import_transform: transform.import_date_time('%Y-%m-%dT%H:%M:%S')
      export_transform: transform.export_date_time('%Y-%m-%dT%H:%M:%S')

    - property: url
      external_name: url
      # Type: Link Stats: 10 properties of this type in this kind.
      import_transform: db.Link

